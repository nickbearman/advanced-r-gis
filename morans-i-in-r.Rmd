---
title: "Moran's I in R"
output: html_document
date: "2023-06-29"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Moran's I in R (optional exercise)

We can also perform the same analysis in R. Load this shapefile back into RStudio. We need to use the `SP` library for these commands.  

```{r, message=FALSE, warning=FALSE, comment=NA, display=FALSE, results='hide'}
#load library
  library(rgdal)
#read in file
  lsoa_manchester_age_imd <- readOGR(".", "lsoa_manchester_age_imd")
```

Your data should look like this:

```{r, comment = NA}
head(GreaterManchester_lsoa_2011_imd@data)
```

To do the Moran's I analysis, we need another library:

```{r, comment=NA, message=FALSE, display=FALSE, warning = FALSE}
#load the library
  library(spdep)
#work out the neighbours
  GreaterManchester_lsoa_nb <- poly2nb(GreaterManchester_lsoa_2011_imd)
#reformat the list of neighbours to a weight matrix
  GreaterManchester_lsoa_lw <- nb2listw(GreaterManchester_lsoa_nb)
#run the test
  moran.test(GreaterManchester_lsoa_2011_imd@data$IMDscor, GreaterManchester_lsoa_lw)
```

This gives us the Moran's I statistic, as well as some associated variables. It is possible to run a whole range of analysis, which goes beyond the scope of this course. 

*Very recently, there is now a R library that allows us to do some of the GeoDa analysis in R - have a look at https://geodacenter.github.io/rgeoda/.*
